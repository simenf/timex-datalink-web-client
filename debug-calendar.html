<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Calendar</title>
    <link rel="stylesheet" href="web/styles/windows98.css">
</head>
<body>
    <div class="desktop">
        <div class="window main-window">
            <div class="title-bar">
                <div class="title-bar-text">Debug Calendar Test</div>
            </div>
            <div class="window-body">
                <button id="debug-btn" class="btn default">Debug Open Calendar</button>
                <div id="debug-log" style="margin-top: 10px; font-family: monospace; font-size: 10px; background: white; padding: 8px; border: 1px solid #808080; height: 200px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <script type="module" src="web/js/window-manager.js"></script>
    <script type="module">
        import { CalendarUI } from './web/js/calendar-ui.js';

        const debugLog = document.getElementById('debug-log');
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `[${timestamp}] ${message}<br>`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message);
        }

        document.getElementById('debug-btn').addEventListener('click', () => {
            log('Debug button clicked');
            
            try {
                log('Checking window.windowManager...');
                if (!window.windowManager) {
                    log('ERROR: window.windowManager is not available');
                    return;
                }
                log('window.windowManager is available');
                log('windowManager type: ' + typeof window.windowManager);
                log('windowManager createWindow method: ' + typeof window.windowManager.createWindow);
                
                // Test creating a simple window first
                log('Testing simple window creation...');
                const testWindow = window.windowManager.createWindow({
                    title: 'Test Window',
                    content: '<p>This is a test window</p>',
                    width: '300px',
                    height: '200px',
                    left: '50px',
                    top: '50px'
                });
                
                if (testWindow) {
                    log('Test window created successfully');
                    log('Test window element: ' + testWindow.tagName);
                    log('Test window in DOM: ' + document.contains(testWindow));
                } else {
                    log('ERROR: Test window creation failed');
                    return;
                }
                
                log('Creating CalendarUI instance...');
                const calendarUI = new CalendarUI(window.windowManager);
                log('CalendarUI instance created successfully');
                
                log('Calling openCalendar()...');
                const result = calendarUI.openCalendar();
                log('openCalendar() returned: ' + result);
                
                if (calendarUI.calendarWindow) {
                    log('Calendar window created successfully');
                    log('Calendar window element: ' + calendarUI.calendarWindow.tagName);
                    log('Calendar window in DOM: ' + document.contains(calendarUI.calendarWindow));
                    log('Calendar window visible: ' + (calendarUI.calendarWindow.offsetWidth > 0 && calendarUI.calendarWindow.offsetHeight > 0));
                } else {
                    log('ERROR: Calendar window was not created');
                }
                
            } catch (error) {
                log('ERROR: ' + error.message);
                log('Stack trace: ' + error.stack);
            }
        });

        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', () => {
            log('DOM loaded');
            
            // Check if window manager is available
            setTimeout(() => {
                if (window.windowManager) {
                    log('Window manager is available after DOM load');
                } else {
                    log('Window manager is NOT available after DOM load');
                }
            }, 100);
        });

        log('Debug script loaded');
    </script>
</body>
</html>